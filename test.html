<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPS ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #666;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .action-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-button {
            flex: 1;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .action-button:hover {
            transform: translateY(-2px);
        }

        .action-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speaker-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: #f8f9fa;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .speaker-icon {
            font-size: 2rem;
            color: #ccc;
            transition: all 0.3s ease;
        }

        .speaker-container.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .speaker-container.active .speaker-icon {
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .status-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .audio-controls {
            margin-top: 1rem;
            text-align: center;
        }

        .audio-controls audio {
            width: 100%;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ MPS í…ŒìŠ¤íŠ¸</h1>
            <p>ìŒì› ì¬ìƒ ë° ê°€ì‚¬ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸</p>
        </div>

        <div class="form-group">
            <label for="endpoint">API ì—”ë“œí¬ì¸íŠ¸</label>
            <input 
                type="text" 
                id="endpoint" 
                placeholder="ì˜ˆ: api/music/1/play ë˜ëŠ” api/lyric/1/download"
                value="api/music/1/play"
            >
        </div>

        <div class="form-group">
            <label for="apiKey">API Key</label>
            <input 
                type="text" 
                id="apiKey" 
                placeholder="ì—¬ê¸°ì— API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                value="test-api-key-12345"
            >
        </div>

        <div class="action-section">
            <button class="action-button" id="actionButton">
                <span id="buttonText">ì¬ìƒ</span>
                <span class="loading hidden" id="loadingSpinner"></span>
            </button>
            <div class="speaker-container" id="speakerContainer">
                <div class="speaker-icon">ğŸ”Š</div>
            </div>
        </div>

        <div class="status-message hidden" id="statusMessage"></div>
        
        <div class="audio-controls hidden" id="audioControls">
            <audio controls id="audioPlayer">
                <source src="" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
    </div>

    <script>
        const endpointInput = document.getElementById('endpoint');
        const apiKeyInput = document.getElementById('apiKey');
        const actionButton = document.getElementById('actionButton');
        const buttonText = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const speakerContainer = document.getElementById('speakerContainer');
        const statusMessage = document.getElementById('statusMessage');
        const audioControls = document.getElementById('audioControls');
        const audioPlayer = document.getElementById('audioPlayer');

        // MPS ì„œë¹„ìŠ¤ ë² ì´ìŠ¤ URL (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ë³€ê²½ í•„ìš”)
        const MPS_BASE_URL = 'https://api.mps.com/'; // ì‹¤ì œ MPS ì„œë¹„ìŠ¤ URLë¡œ ë³€ê²½

        // ë”ë¯¸ ë°ì´í„° - Web Audio APIë¥¼ ì‚¬ìš©í•´ ê°„ë‹¨í•œ í†¤ ìƒì„±
        function createDummyAudio() {
            // AudioContextë¥¼ ì‚¬ìš©í•´ ê°„ë‹¨í•œ ì‚¬ì¸íŒŒ ìƒì„±
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const duration = 5; // 5ì´ˆ
            const sampleRate = audioContext.sampleRate;
            const buffer = audioContext.createBuffer(1, duration * sampleRate, sampleRate);
            const data = buffer.getChannelData(0);
            
            // 440Hz (A4 ìŒ) ì‚¬ì¸íŒŒ ìƒì„±
            for (let i = 0; i < data.length; i++) {
                data[i] = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 0.3;
            }
            
            return buffer;
        }

        // ë”ë¯¸ ì˜¤ë””ì˜¤ URL (ì‹¤ì œ ì‘ë™í•˜ëŠ” ì§§ì€ ë¬´ìŒ MP3)
        const DUMMY_AUDIO_URL = 'data:audio/mp3;base64,//tQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA//+QkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQ//+QkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQ';
        const DUMMY_LYRICS = `[00:00.00] í…ŒìŠ¤íŠ¸ ìŒì› ê°€ì‚¬
[00:10.00] MPS ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ
[00:20.00] ë”ë¯¸ ê°€ì‚¬ íŒŒì¼ì…ë‹ˆë‹¤
[00:30.00] ì‹¤ì œ ê°€ì‚¬ë¡œ êµì²´í•´ ì£¼ì„¸ìš”`;

        // ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ ê°ì§€ ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        endpointInput.addEventListener('input', updateButtonText);

        function updateButtonText() {
            const endpoint = endpointInput.value.trim();
            if (endpoint.includes('/music/') && endpoint.includes('/play')) {
                buttonText.textContent = 'ì¬ìƒ';
            } else if (endpoint.includes('/lyric/') && endpoint.includes('/download')) {
                buttonText.textContent = 'ê°€ì‚¬ ë‹¤ìš´ë¡œë“œ';
            } else {
                buttonText.textContent = 'ìš”ì²­';
            }
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.classList.remove('hidden');
        }

        function hideStatus() {
            statusMessage.classList.add('hidden');
        }

        function setLoading(loading) {
            if (loading) {
                buttonText.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
                actionButton.disabled = true;
            } else {
                buttonText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                actionButton.disabled = false;
            }
        }

        function activateSpeaker() {
            speakerContainer.classList.add('active');
        }

        function deactivateSpeaker() {
            speakerContainer.classList.remove('active');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        // Web Audio APIë¡œ ë¹„í”„ìŒ ìƒì„± ë° ì¬ìƒ
        function playBeepSound(audioContext, musicId) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4 ìŒ
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 3);
            
            showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì¤‘... (í…ŒìŠ¤íŠ¸ í†¤)`, 'info');
            
            oscillator.onended = () => {
                deactivateSpeaker();
                showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì™„ë£Œ`, 'success');
            };
        }

        // ì‹œê°ì  ì¬ìƒ ì‹œë®¬ë ˆì´ì…˜
        function simulatePlayback(musicId) {
            showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì¤‘... (ì‹œë®¬ë ˆì´ì…˜)`, 'info');
            
            // 3ì´ˆ í›„ ì¬ìƒ ì™„ë£Œ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                deactivateSpeaker();
                showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì™„ë£Œ`, 'success');
            }, 3000);
        }

        async function makeRequest() {
            const endpoint = endpointInput.value.trim();
            const apiKey = apiKeyInput.value.trim();

            if (!endpoint || !apiKey) {
                showStatus('ì—”ë“œí¬ì¸íŠ¸ì™€ API í‚¤ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            setLoading(true);
            hideStatus();
            deactivateSpeaker();
            audioControls.classList.add('hidden');

            try {
                // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì´ ë¶€ë¶„ì„ ì‹¤ì œ API í˜¸ì¶œë¡œ êµì²´
                const fullUrl = MPS_BASE_URL + endpoint;
                console.log(`ìš”ì²­ URL: ${fullUrl}`);
                console.log(`API Key: ${apiKey}`);

                // ë”ë¯¸ API ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
                await new Promise(resolve => setTimeout(resolve, 1500)); // ë¡œë”© ì‹œë®¬ë ˆì´ì…˜

                // API í‚¤ ê²€ì¦ ì‹œë®¬ë ˆì´ì…˜
                if (apiKey !== 'test-api-key-12345' && apiKey !== 'valid-api-key') {
                    throw new Error('INVALID_API_KEY');
                }

                if (endpoint.includes('/music/') && endpoint.includes('/play')) {
                    // ìŒì› ì¬ìƒ ì²˜ë¦¬
                    const musicId = endpoint.match(/\/music\/(\d+)\/play/)?.[1];
                    if (!musicId) {
                        throw new Error('ì˜ëª»ëœ ìŒì› ì—”ë“œí¬ì¸íŠ¸ í˜•ì‹ì…ë‹ˆë‹¤.');
                    }

                    showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì¤€ë¹„ ì™„ë£Œ`, 'success');
                    activateSpeaker();
                    
                    // ì‹¤ì œ ì˜¤ë””ì˜¤ ëŒ€ì‹  Web Audio APIë¡œ í†¤ ìƒì„± ë° ì¬ìƒ
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        
                        // ë”ë¯¸ ì˜¤ë””ì˜¤ íŒŒì¼ ì„¤ì •
                        audioPlayer.src = DUMMY_AUDIO_URL;
                        audioControls.classList.remove('hidden');
                        
                        // ìˆ˜ë™ìœ¼ë¡œ ì¬ìƒ ì‹œì‘
                        const playPromise = audioPlayer.play();
                        
                        if (playPromise !== undefined) {
                            playPromise.then(() => {
                                showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì¤‘...`, 'info');
                            }).catch((error) => {
                                console.warn('ìë™ ì¬ìƒ ì‹¤íŒ¨, ìˆ˜ë™ ì¬ìƒìœ¼ë¡œ ì „í™˜:', error);
                                showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì¤€ë¹„ë¨ (ì¬ìƒ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”)`, 'info');
                            });
                        }
                        
                        // ì˜¤ë””ì˜¤ ì¬ìƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                        audioPlayer.addEventListener('play', () => {
                            showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì¤‘...`, 'info');
                        }, { once: false });
                        
                        audioPlayer.addEventListener('ended', () => {
                            deactivateSpeaker();
                            showStatus(`ìŒì› ${musicId}ë²ˆ ì¬ìƒ ì™„ë£Œ`, 'success');
                        }, { once: false });
                        
                        audioPlayer.addEventListener('error', (e) => {
                            console.error('ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', e);
                            deactivateSpeaker();
                            
                            // Web Audio APIë¡œ ëŒ€ì²´ ì¬ìƒ
                            playBeepSound(audioContext, musicId);
                        }, { once: false });
                        
                    } catch (audioError) {
                        console.warn('AudioContext ìƒì„± ì‹¤íŒ¨:', audioError);
                        // AudioContext ì‹¤íŒ¨ì‹œ ì‹œê°ì  ì‹œë®¬ë ˆì´ì…˜ë§Œ ì‹¤í–‰
                        simulatePlayback(musicId);
                    }

                } else if (endpoint.includes('/lyric/') && endpoint.includes('/download')) {
                    // ê°€ì‚¬ ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬
                    const musicId = endpoint.match(/\/lyric\/(\d+)\/download/)?.[1];
                    if (!musicId) {
                        throw new Error('ì˜ëª»ëœ ê°€ì‚¬ ì—”ë“œí¬ì¸íŠ¸ í˜•ì‹ì…ë‹ˆë‹¤.');
                    }

                    downloadFile(DUMMY_LYRICS, `lyrics_${musicId}.txt`, 'text/plain');
                    showStatus(`ìŒì› ${musicId}ë²ˆ ê°€ì‚¬ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`, 'success');
                    
                } else {
                    throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ì—”ë“œí¬ì¸íŠ¸ í˜•ì‹ì…ë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ìš”ì²­ ì‹¤íŒ¨:', error);
                
                if (error.message === 'INVALID_API_KEY') {
                    showStatus('ìœ íš¨í•˜ì§€ ì•Šì€ API í‚¤ì…ë‹ˆë‹¤.', 'error');
                } else {
                    showStatus(`ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
                
                deactivateSpeaker();
            } finally {
                setLoading(false);
            }
        }

        // ì‹¤ì œ API í˜¸ì¶œ í•¨ìˆ˜ (í˜„ì¬ëŠ” ì£¼ì„ ì²˜ë¦¬, ì‹¤ì œ í™˜ê²½ì—ì„œ ì‚¬ìš©)
        /*
        async function makeActualRequest(endpoint, apiKey) {
            const response = await fetch(MPS_BASE_URL + endpoint, {
                method: 'GET',
                headers: {
                    'X-API-Key': apiKey,
                    'Accept': endpoint.includes('/music/') ? 'audio/mpeg' : 'text/plain'
                }
            });

            if (!response.ok) {
                if (response.status === 401 || response.status === 403) {
                    throw new Error('INVALID_API_KEY');
                }
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            return response;
        }
        */

        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        actionButton.addEventListener('click', makeRequest);

        // ì—”í„° í‚¤ ì²˜ë¦¬
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !actionButton.disabled) {
                makeRequest();
            }
        });

        // ì´ˆê¸°í™”
        updateButtonText();
    </script>
</body>
</html>